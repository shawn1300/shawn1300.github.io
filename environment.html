<!DOCTYPE html>
<html>
<head>
     <nav class="navbar">
                <a href="../index.html" class="logo">
                    <i class="fas fa-arrow-left"></i> è¿”å›é¦–é¡µ
                </a>
                <div style="display: flex; gap: 20px;">
                    <a href="#search" style="text-decoration: none; color: var(--dark-color);">
                        <i class="fas fa-search"></i> æœç´¢
                    </a>
    <title>ç¯å¢ƒç›‘æµ‹ä»ªè¡¨æ¿</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            padding: 20px;
        }
        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .device-selector {
            margin: 20px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="device-selector">
        <select id="deviceSelect">
            <option value="home-01">å®¶é‡Œ</option>
            <option value="office-01">å…¬å¸</option>
        </select>
    </div>
    
    <div class="dashboard">
        <div class="card">
            <h3>ğŸŒ¡ï¸ æ¸©åº¦</h3>
            <div class="value" id="temp">-- Â°C</div>
        </div>
        <div class="card">
            <h3>ğŸ’§ æ¹¿åº¦</h3>
            <div class="value" id="humidity">-- %</div>
        </div>
        <div class="card">
            <h3>ğŸ˜· PM2.5</h3>
            <div class="value" id="pm25">-- Î¼g/mÂ³</div>
            <div class="quality" id="airQuality"></div>
        </div>
    </div>
    
    <div class="card">
        <h3>ğŸ“ˆ å†å²è¶‹åŠ¿</h3>
        <canvas id="chart"></canvas>
    </div>

    <script>
        const SUPABASE_URL = 'ä½ çš„Supabase URL';
        const SUPABASE_KEY = 'ä½ çš„anon key';
        let currentDevice = 'home-01';
        
        async function fetchLatestData() {
            const response = await fetch(
                `${SUPABASE_URL}/rest/v1/sensor_data?device_id=eq.${currentDevice}&order=created_at.desc&limit=1`,
                {
                    headers: { 'apikey': SUPABASE_KEY }
                }
            );
            const data = await response.json();
            updateDisplay(data[0]);
        }
        
        async function fetchHistory() {
            const response = await fetch(
                `${SUPABASE_URL}/rest/v1/sensor_data?device_id=eq.${currentDevice}&order=created_at.desc&limit=50`,
                { headers: { 'apikey': SUPABASE_KEY } }
            );
            return await response.json();
        }
        
        function updateDisplay(data) {
            if (!data) return;
            
            document.getElementById('temp').textContent = `${data.temperature.toFixed(1)} Â°C`;
            document.getElementById('humidity').textContent = `${data.humidity.toFixed(1)} %`;
            document.getElementById('pm25').textContent = `${data.pm25.toFixed(1)} Î¼g/mÂ³`;
            
            // ç©ºæ°”è´¨é‡è¯„çº§
            const quality = getAirQuality(data.pm25);
            document.getElementById('airQuality').textContent = quality;
            document.getElementById('airQuality').className = `quality ${quality.toLowerCase()}`;
        }
        
        function getAirQuality(pm25) {
            if (pm25 <= 35) return 'ä¼˜ ğŸ‘';
            if (pm25 <= 75) return 'è‰¯ ğŸ‘Œ';
            if (pm25 <= 115) return 'è½»åº¦æ±¡æŸ“ ğŸ˜·';
            return 'æ±¡æŸ“ä¸¥é‡ âš ï¸';
        }
        
        // å›¾è¡¨åˆå§‹åŒ–
        const ctx = document.getElementById('chart').getContext('2d');
        const chart = new Chart(ctx, {
            type: 'line',
            data: {
                datasets: [
                    { label: 'æ¸©åº¦', borderColor: 'red', data: [] },
                    { label: 'PM2.5', borderColor: 'blue', data: [] }
                ]
            },
            options: { responsive: true }
        });
        
        // å®šæ—¶æ›´æ–°
        setInterval(fetchLatestData, 30000);
        
        // è®¾å¤‡åˆ‡æ¢
        document.getElementById('deviceSelect').addEventListener('change', (e) => {
            currentDevice = e.target.value;
            fetchLatestData();
            updateChart();
        });
        
        // åˆå§‹åŒ–
        fetchLatestData();
    </script>
</body>
</html>
